// [AIV_SHORT]  Build version: 4.68.0 - Tuesday, April 12th, 2022, 8:52:39 AM - common  
 // [AIV_SHORT]  Build version: 4.68.0 - Tuesday, April 12th, 2022, 8:52:39 AM - common  
 (window["webpackJsonpCobrowsing-v4.68.0"]=window["webpackJsonpCobrowsing-v4.68.0"]||[]).push([[2],{21:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(8)),i=n(24),a=r(n(26)),c=r(n(4)),u=r(n(6)),l=n(0),d=n(5),f=r(n(38)),E=r(n(29)),g=r(n(1)),m=n(32),h=r(n(50));function p(e,t,n,o){t&&t.send(e,n||null,o||null)}var v=function(){function e(){var e=this;this.customerMessageHandler=s.default,this.customerErrorHandler=s.default,this.customerCloseHandler=s.default,this.changeVisibility=function(){d.getResoursesSettings().follow_tab&&("visible"===document.visibilityState?e.restoreSession():e.closeAllStreams(!1))},this.restoreSession=function(){e.initialize(e.customerWuid,e.disableStream,e.minDomUpdateTimeout,E.default.ngZone,!0),e.subscribe(e.customerMessageHandler,e.customerErrorHandler,e.customerCloseHandler)},this.initialize=function(t,n,o,r,s){void 0===n&&(n=!1),void 0===o&&(o=500),void 0===s&&(s=!1),E.default.setNgZone(r),e.closeAllStreams(!s);var i=g.default.mockWuid||t;if(e.customerWuid=i&&i.includes("|")?i:g.default.appId+"|"+i,e.disableStream=n,e.minDomUpdateTimeout=o,e.openBrokerSocket(s),s||document.addEventListener("visibilitychange",e.changeVisibility),e.cobrowsingInstance)return e.cobrowsingInstance.initialize(e.customerWuid,n,o,e.socketInstance)},this.isSocketReady=function(){return Boolean(e.socketInstance&&e.socketInstance.isSocketReady())},this.subscribe=function(t,n,o){if(void 0===t&&(t=s.default),void 0===n&&(n=s.default),void 0===o&&(o=s.default),e.customerWuid){if(e.cobrowsingInstance)return e.cobrowsingInstance.subscribe(t,n,o);e.customerMessageHandler=t,e.customerErrorHandler=n,e.customerCloseHandler=o}},this.send=function(t,n,o){if(o&&l.logInfo("settings "+JSON.stringify(o),"","loader"),e.cobrowsingInstance)return e.cobrowsingInstance.send(t,n,o);"boolean"!=typeof o&&(e.startSettings=o),e.handlePlatformMessage(t,n,o)},this.closeAllStreams=function(t){if(void 0===t&&(t=!0),t&&document.removeEventListener("visibilitychange",e.changeVisibility),e.closeLoaderSocket(),e.cobrowsingInstance)return e.cobrowsingInstance.closeAllStreams()},this.waitEstablishedMessage=function(){window.cobrowsingPackageVersion&&e.socketInstance.setBrokerReady(!1)},this.openConnection=function(t){if(!e.customerWuid)return l.logError("User not initialized"),void e.sendLogMessage("Trying send message without inilializing","error",{key:u.default.common});e.socketInstance.isSocketInitialized()||(l.logError("Socket not initialized"),e.sendLogMessage("Trying send message without socket initialization","error",{key:u.default.common})),n.e(1).then(function(o){var r=n(58).default;e.cobrowsingInstance=new r,e.cobrowsingInstance&&(e.cobrowsingInstance.initialize(e.customerWuid,e.disableStream,e.minDomUpdateTimeout,e.socketInstance),e.cobrowsingInstance.subscribe(e.customerMessageHandler,e.customerErrorHandler,e.customerCloseHandler),e.cobrowsingInstance.send(a.default.SESSION_RESTORED,t,e.startSettings),delete e.startSettings,clearTimeout(e.pingTimer),clearTimeout(e.restoreSessionTimer))}.bind(null,n)).catch(n.oe)},this.handleSessionConfirmation=function(){l.logInfo("SEND:",c.default[c.default.confirmation],"loader"),p(c.default.confirmation,e.socketInstance)},this.handleStartRecord=function(t,n){var o="boolean"==typeof n?{forced:n}:n;p(c.default.start,e.socketInstance,t,o)},this.handleStopRecord=function(t){p(c.default.stop,e.socketInstance,t)},this.handleStopLightRecord=function(t){p(c.default.stop_light,e.socketInstance,t)},this.handleCustomData=function(t){p(c.default.custom,e.socketInstance,[t.name,t.value])},this.handleSessionRequest=function(){p(c.default.request,e.socketInstance),e.sendLogMessage("Customer session request","info",{key:u.default.session})},this.handlePlatformMessage=function(t,n,o){var r=d.getResoursesSettings().records_enabled;switch(t){case a.default.SESSION_CONFIRMATION:if(e.sessionRejected)return;e.requestTimeout&&clearTimeout(e.requestTimeout),e.waitEstablishedMessage(),e.handleSessionConfirmation(),e.sendLogMessage("Session created","info",{key:u.default.session});break;case a.default.SESSION_REFUSE:if(e.sessionRejected)return;e.requestTimeout&&clearTimeout(e.requestTimeout),e.waitEstablishedMessage(),e.handleSessionRefuse(),e.sendLogMessage("Session refused","info",{key:u.default.session});break;case a.default.START_RECORD:if(!r||!n||"string"!=typeof n){var s=r?"Empty record token":"Records not enabled";return l.logInfo(s,"","loader"),void e.sendLogMessage(s,"error",{key:u.default.records})}e.waitEstablishedMessage(),e.handleStartRecord(n,o),e.sendLogMessage("Record started","info",{forced:"object"==typeof o?o.forced:o,unit:"object"==typeof o&&o.unit||"none",recordToken:n,key:u.default.records});break;case a.default.STOP_LIGHT_RECORD:if(!n||"string"!=typeof n)return;e.waitEstablishedMessage(),e.sendLogMessage("Light record stopped","info",{recordToken:n,key:u.default.records}),e.handleStopLightRecord(n);break;case a.default.STOP_RECORD:if(n&&"string"!=typeof n)return;e.waitEstablishedMessage(),e.sendLogMessage("Record stopped","info",{recordToken:n,key:u.default.records}),e.handleStopRecord(n);break;case a.default.CUSTOM_DATA:if(!n||"string"==typeof n)return;e.handleCustomData(n);break;case a.default.SESSION_REQUEST:return void e.handleSessionRequest();default:return void l.logError("Unhandled message type: "+t,{},"loader")}},this.handleSocketMessage=function(t){var n=JSON.parse(t.data);switch(l.logInfo("RECEIVE: "+c.default[n[0]],n,"loader"),e.setPingTimer(),e.setRestoreSessionTimer(),n[i.Keys.type]){case c.default.record_length:return void f.default(n,e.resolver);case c.default.config:return void d.setResoursesConfig(n[i.Keys.data]);case c.default.request:if(e.sessionRejected=!1,d.getResoursesSettings().need_confirmation&&-1===n[i.Keys.data].indexOf("from_code"))return l.logInfo("SEND:",a.default.SESSION_REQUEST,"loader"),e.customerMessageHandler({type:a.default.SESSION_REQUEST}),e.requestTimeout&&clearTimeout(e.requestTimeout),void(e.requestTimeout=setTimeout((function(){l.logInfo("SEND:",a.default.SESSION_REJECTED,"loader"),e.customerMessageHandler({type:a.default.SESSION_REJECTED}),e.sessionRejected=!0}),m.DEFAULT_MAX_WAITING_TIME));e.sendLogMessage("Session created","info",{key:u.default.session}),e.handleSessionConfirmation();break;case c.default.restored:e.openConnection(n[i.Keys.data]);break;case c.default.uniq_code:l.logInfo("SEND:",a.default.SESSION_CODE,"loader"),e.customerMessageHandler({type:a.default.SESSION_CODE,data:n[i.Keys.data]});break;case c.default.established:delete e.startSettings;break;case c.default.pong:case c.default.close:break;default:l.logError("Unhandled message type "+n.type,{},"loader")}},this.closeLoaderSocket=function(){e.socketInstance&&(e.socketInstance.close("closeLoaderSocket"),clearTimeout(e.pingTimer),clearTimeout(e.restoreSessionTimer),clearTimeout(e.requestTimeout))},E.default.runOutsideAngular((function(){window.postMessage(JSON.stringify({message:"cobrowsingReady"}),"*")}))}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getRecordedTime=function(e){var t=this,n=new Promise((function(e,n){t.resolver=e,setTimeout((function(){return n("timeout")}),1e4)}));return p(c.default.record_length,this.socketInstance,e),this.cobrowsingInstance&&this.cobrowsingInstance.setResolver?(this.cobrowsingInstance.setResolver(this.resolver),n):n},e.prototype.openBrokerSocket=function(e){void 0===e&&(e=!1),this.socketInstance=h.default.getInstance(),this.socketInstance.initialize(this.customerWuid,this.handleSocketMessage,this.disableStream,e),this.socketInstance.setCloseMessageHandler(this.closeLoaderSocket),this.socketInstance.setErrorMessageHandler(this.closeLoaderSocket)},e.prototype.sendLogMessage=function(e,t,n){l.sendLog(o({appId:g.default.appId,wuid:this.customerWuid,message:e,lvl:t},n))},e.prototype.setPingTimer=function(){var e=this;void 0!==this.pingTimer&&clearTimeout(this.pingTimer),this.pingTimer=setTimeout((function(){l.logInfo("send PING","","loader"),p(c.default.ping,e.socketInstance),e.setPingTimer()}),m.DEFAULT_MAX_DELAY)},e.prototype.setRestoreSessionTimer=function(){var e=this;void 0!==this.restoreSessionTimer&&clearTimeout(this.restoreSessionTimer),this.restoreSessionTimer=setTimeout((function(){l.logInfo("trying to restore session"),e.reconnectToBroker("setRestoreSessionTimer"),e.restoreSessionTimer=null}),m.DEFAULT_MAX_DELIVERY_TIME)},e.prototype.handleSessionRefuse=function(){p(c.default.refuse,this.socketInstance)},e.prototype.reconnectToBroker=function(e){var t=this;clearTimeout(this.pingTimer),clearTimeout(this.restoreSessionTimer),clearTimeout(this.requestTimeout),this.socketInstance&&(this.socketInstance.reconnectToBroker(e),this.socketInstance.on("open",(function(){t.setPingTimer()})))},e}();t.default=v},23:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTimestamp=void 0;var o=n(2);t.getTimestamp=function(e){return void 0!==e?Date.now()*o.ADDITIONAL_TIME_ORDER+e:Date.now()*o.ADDITIONAL_TIME_ORDER}},24:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataKeys=t.MKeys=t.Keys=t.MutationTypes=t.isCustomerMessageData=void 0;var r,s,i,a,c=o(n(4));!function(e){e[e.atomic=0]="atomic",e[e.attribute=1]="attribute",e[e.replace=2]="replace",e[e.add=3]="add",e[e.remove=4]="remove",e[e.removeNode=5]="removeNode",e[e.addNode=6]="addNode",e[e.updateText=7]="updateText"}(r||(r={})),t.MutationTypes=r,function(e){e[e.type=0]="type",e[e.id=1]="id",e[e.data=2]="data",e[e.frame=3]="frame"}(s||(s={})),t.Keys=s,function(e){e[e.type=0]="type",e[e.selector=1]="selector",e[e.data=2]="data"}(i||(i={})),t.MKeys=i,function(e){e[e.type=0]="type",e[e.data=1]="data"}(a||(a={})),t.DataKeys=a;var u=[c.default.init,c.default.click,c.default.cursor,c.default.touch,c.default.resize,c.default.scroll,c.default.url,c.default.body,c.default.head,c.default.checkbox,c.default.ua,c.default.mark,c.default.html];t.isCustomerMessageData=function(e){return u.indexOf(e)>-1}},26:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.GOOD_CONNECTION="GOOD_CONNECTION",e.BAD_CONNECTION="BAD_CONNECTION",e.CONNECTION_LOST="CONNECTION_LOST",e.SESSION_CLOSE="SESSION_CLOSE",e.SESSION_REQUEST="SESSION_REQUEST",e.SESSION_REJECTED="SESSION_REJECTED",e.NO_CONNECTION="NO_CONNECTION",e.MARK_AREA="MARK_AREA",e.ERROR="ERROR",e.WARNING="WARNING",e.HIDE_WARNING="HIDE_WARNING",e.START_RECORD="START_RECORD",e.RECORD_LOADED="RECORD_LOADED",e.PAUSE="PAUSE",e.PLAY="PLAY",e.STOP="STOP",e.SET_TIME="SET_TIME",e.SET_SPEED="SET_SPEED",e.SESSION_CONFIRMATION="SESSION_CONFIRMATION",e.SESSION_REFUSE="SESSION_REFUSE",e.STOP_RECORD="STOP_RECORD",e.MESSAGE="MESSAGE",e.CURRENT_TIME="CURRENT_TIME",e.POST_STATE="POST_STATE",e.READY_STATE="READY_STATE",e.FINISHED_STATE="FINISHED_STATE",e.SESSION_RESTORED="SESSION_RESTORED",e.CUSTOM_DATA="CUSTOM_DATA",e.STOP_LIGHT_RECORD="STOP_LIGHT_RECORD",e.SESSION_CODE="SESSION_CODE",e.GET_RECORD_ACTIONS="GET_RECORD_ACTIONS",e.RECORD_ACTIONS="RECORD_ACTIONS",e.SET_ID="SET_ID",e.CUT_INTERVALS="CUT_INTERVALS",e.UPDATE_PAUSE_TIMEOUT="UPDATE_PAUSE_TIMEOUT",e.CONSOLE_MESSAGE="CONSOLE_MESSAGE",e.EMPTY_STREAM="EMPTY_STREAM"}(o||(o={})),t.default=o},29:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=new function(){var e=this;this.ngZone=null,this.setNgZone=function(t){e.ngZone=t},this.runOutsideAngular=function(t){return e.ngZone&&e.ngZone.runOutsideAngular&&e.ngZone.runOutsideAngular(t)||t()}};t.default=o},32:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_WAITING_TIME=t.MAX_DELIVERY_TIME=t.MAX_DELAY=t.DEBOUNCE_DELAY=t.DEFAULT_MAX_WAITING_TIME=t.DEFAULT_MAX_DELIVERY_TIME=t.DEFAULT_MAX_DELAY=void 0,t.DEFAULT_MAX_DELAY=5e3,t.DEFAULT_MAX_DELIVERY_TIME=15e3,t.DEFAULT_MAX_WAITING_TIME=4*t.DEFAULT_MAX_DELIVERY_TIME,t.DEBOUNCE_DELAY=100,t.MAX_DELAY=t.DEFAULT_MAX_DELAY,t.MAX_DELIVERY_TIME=t.DEFAULT_MAX_DELIVERY_TIME,t.MAX_WAITING_TIME=t.DEFAULT_MAX_WAITING_TIME},38:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(24),r=n(0);t.default=function(e,t){if(t)if(r.logInfo(e),e[o.Keys.data]){var n=e[o.Keys.data];t({startTime:n[0],duration:n[1]})}else t(null)}},39:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBrowserData=void 0;var o=n(40),r="name",s="version";function i(e,t){for(var n,o=0;o<t.length&&!n;){for(var r=t[o],s=t[o+1],i=0,a=0;i<r.length&&!n;)if(n=r[i++].exec(e))for(var c=0;c<s.length;c++){var u=n[++a],l=s[c];"object"==typeof l&&l.length>0?2===l.length&&(this[l[0]]=l[1]):this[l]=u||void 0}o+=2}}var a=[[/\b(?:crmo|crios)\/([\w\.]+)/i],[s,[r,o.BrowserName.CHROME]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[s,[r,o.BrowserName.EDGE]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[[r,o.BrowserName.OPERA],s],[/opios[\/ ]+([\w\.]+)/i],[s,[r,o.BrowserName.OPERA]],[/\bopr\/([\w\.]+)/i],[s,[r,o.BrowserName.OPERA]],[/(?:ms|\()(ie) ([\w\.]+)/i],[r,s],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[s,[r,o.BrowserName.IE]],[/yabrowser\/([\w\.]+)/i],[s,[r,o.BrowserName.YANDEX]],[/\bfocus\/([\w\.]+)/i],[s,[r,o.BrowserName.FIREFOX_FOCUS]],[/\bopt\/([\w\.]+)/i],[s,[r,o.BrowserName.OPERA]],[/coast\/([\w\.]+)/i],[s,[r,o.BrowserName.OPERA]],[/fxios\/([-\w\.]+)/i],[s,[r,o.BrowserName.FIREFOX]],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[r,o.BrowserName.WEBVIEW],s],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[r,s],[/headlesschrome(?:\/([\w\.]+)| )/i],[s,[r,o.BrowserName.CHROME]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[r,o.BrowserName.CHROME],s],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[r,s],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[s,[r,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[s,r],[/(webkit|khtml)\/([\w\.]+)/i],[r,s],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[s,[r,o.BrowserName.FIREFOX]],[/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i],[r,s]];t.getBrowserData=function(e){var t;void 0===e&&(e="");var n=((t={})[r]="",t[s]="",t);return i.call(n,e,a),n}},40:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserName=void 0,function(e){e.UNKNOWN="UNKNOWN",e.CHROME="Chrome",e.SAFARI="Safari",e.OPERA="Opera",e.FIREFOX="Firefox",e.FIREFOX_FOCUS="Firefox focus",e.IE="Internet Explorer",e.EDGE="Edge",e.YANDEX="Yandex",e.WEBVIEW="Webview",e.WEBKIT="WebKit",e.MOBILE="Mobile "}(o||(o={})),t.BrowserName=o},41:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.MessagePrefix=void 0,function(e){e.data="D:",e.service="",e.custom="C:"}(o||(o={})),t.MessagePrefix=o},50:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=u(n(8)),d=c(n(51)),f=u(n(4)),E=u(n(6)),g=n(0),m=u(n(52)),h=u(n(53)),p=n(54),v=u(n(55)),S=u(n(29)),I=n(23),_=u(n(1)),O=n(41),T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.customerErrorHandler=l.default,t.customerCloseHandler=l.default,t.customerOpenHandler=l.default,t.restoreCount=0,t.isBrokerReady=!1,t.isReadyForLogs=!1,t.initialize=function(e,n,o,r){void 0===o&&(o=!1),void 0===r&&(r=!1),g.logInfo("initialize socket "+e);var s=t.setMessageHandlerMiddleware(n);if(r||t.customerWuid!==e||t.disableStream!==o||t.socketMessageHandler.toString()!==s.toString()){t.customerWuid=e,t.socketMessageHandler=s,t.disableStream=o;var i=p.cobrowsingEnabled(navigator);g.logInfo("cobrowsingEnabled",i,"enabled"),i?(t.socketInstance&&t.close("initialize"),t.openSocket()):t.sendLogMessage("cobrowsing not enabled in this browser","error",{key:E.default.connection,url:navigator.userAgent})}},t.setMessageHandler=function(e){t.socketInstance&&(g.logInfo("change message handler"),t.socketInstance.removeEventListener("message",t.handleSocketMessage,!1),t.socketMessageHandler=t.setMessageHandlerMiddleware(e),S.default.runOutsideAngular((function(){t.socketInstance.addEventListener("message",t.handleSocketMessage,!1)})))},t.setErrorMessageHandler=function(e){t.socketInstance&&(g.logInfo("set error message handler"),t.socketInstance.removeEventListener("error",t.handleSocketError,!1),t.customerErrorHandler=e,S.default.runOutsideAngular((function(){t.socketInstance.addEventListener("error",t.handleSocketError,!1)})))},t.setCloseMessageHandler=function(e){t.socketInstance&&(g.logInfo("set close message handler"),t.socketInstance.removeEventListener("close",t.handleSocketClose,!1),t.customerCloseHandler=e,S.default.runOutsideAngular((function(){t.socketInstance.addEventListener("close",t.handleSocketClose,!1)})))},t.setMessageHandlerMiddleware=function(e){return g.logInfo("set message message handler"),function(n){t.restoreCount&&(t.restoreCount=0,t.cancelReconnection()),e(n)}},t.setOpenMessageHandler=function(e){t.socketInstance&&(g.logInfo("set open message handler"),t.socketInstance.removeEventListener("open",t.handleSocketOpen,!1),t.customerOpenHandler=e,t.socketInstance.addEventListener("open",t.handleSocketOpen,!1))},t.isSocketReady=function(){return Boolean(t.socketInstance&&t.socketInstance.readyState===WebSocket.OPEN&&t.isBrokerReady)},t.isSocketInitialized=function(){return Boolean(t.socketInstance)},t.reconnectTimerFunction=function(){t.close("reconnectTimerFunction"),g.logInfo("reconnect socket",t.restoreCount),t.openSocket(),t.restoreCount++},t.cancelReconnection=function(){g.logInfo("try to cancel reconnection"),t.reconnectTimer&&(g.logInfo("cancel reconnection"),clearTimeout(t.reconnectTimer))},t.close=function(e){g.logInfo("close socket because of method, reason: "+e),t.cancelReconnection(),t.socketInstance?(g.logInfo("remove all listeners"),t.socketInstance.removeEventListener("message",t.handleSocketMessage,!1),t.socketInstance.removeEventListener("close",t.handleSocketClose,!1),t.socketInstance.removeEventListener("error",t.handleSocketError,!1),t.socketInstance.close(),delete t.socketInstance):g.logInfo("no socket instance")},t.setBrokerReady=function(e){void 0===e&&(e=!0),t.isBrokerReady=e,e&&S.default.runOutsideAngular((function(){window.postMessage(JSON.stringify({message:"cobrowsingConnectionReady"}),"*")}))},t.openSocket=function(){if(t.socketInstance)g.logInfo("an attempt to open socket without closing previous one");else{g.logInfo("open new socket");var e=h.default({protocol:_.default.wsProtocol,host:_.default.wsHost,port:_.default.wsPort,params:m.default(t.customerWuid,_.default.appId,t.disableStream)});t.socketInstance=new WebSocket(e),S.default.runOutsideAngular((function(){g.logInfo("subscribe event listeners"),t.socketInstance.addEventListener("open",t.handleSocketOpen,!1),t.socketInstance.addEventListener("error",t.handleSocketError,!1),t.socketInstance.addEventListener("close",t.handleSocketClose,!1),t.socketInstance.addEventListener("message",t.handleSocketMessage,!1)}))}},t.handleSocketError=function(e){g.logInfo("handle socket error"),t.setBrokerReady(!1),t.customerErrorHandler(e),t.reconnectToBroker("handleSocketError"),t.isReadyForLogs&&(t.sendLogMessage("user socket error","error",{key:E.default.connection}),t.isReadyForLogs=!1)},t.handleSocketOpen=function(e){g.logInfo("handle socket open"),t.setBrokerReady(!1),t.customerOpenHandler(e),t.emit("open")},t.handleSocketClose=function(e){g.logInfo("handle socket close"),t.setBrokerReady(!1),g.logInfo('closing due "close" message'),t.customerCloseHandler(e),t.isReadyForLogs?(t.sendLogMessage("user socket closed","info",{code:v.default(e.code),key:E.default.connection}),t.isReadyForLogs=!1):t.sendLogMessage("user not ready socket closed","error"),t.reconnectToBroker("handleSocketClose")},t.handleSocketMessage=function(e){if(!t.isBrokerReady){var n=JSON.parse(e.data)[0];n!==f.default.established&&n!==f.default.restored||t.setBrokerReady(),n===f.default.config&&(t.sendLogMessage("user socket ready","info",{key:E.default.connection}),t.isReadyForLogs=!0)}t.socketMessageHandler(e)},t}return r(t,e),t.getInstance=function(){return t.instance||(g.logInfo("getting new instance of socket"),t.instance=new t),t.instance},t.prototype.send=function(e,t,n){if(void 0===t&&(t=null),void 0===n&&(n=null),this.socketInstance instanceof WebSocket&&this.socketInstance.readyState===WebSocket.OPEN){if(e===f.default.custom)return void this.socketInstance.send(O.MessagePrefix.custom+JSON.stringify([e,I.getTimestamp(),t]));this.socketInstance.send(JSON.stringify([e,Date.now(),t,n]))}},t.prototype.sendPrepared=function(e){this.socketInstance instanceof WebSocket&&this.socketInstance.readyState===WebSocket.OPEN&&this.socketInstance.send(e)},t.prototype.reconnectToBroker=function(e){this.cancelReconnection(),g.logInfo("set reconnect socket "+e,this.restoreCount),this.reconnectTimer=window.setTimeout(this.reconnectTimerFunction,1e4*this.restoreCount)},t.prototype.sendLogMessage=function(e,t,n){g.sendLog(s({wuid:this.customerWuid,message:e,lvl:t},n))},t}(d.EventEmitter);t.default=T},51:function(e,t,n){"use strict";var o,r="object"==typeof Reflect?Reflect:null,s=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};o=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,o){function r(n){e.removeListener(t,s),o(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}p(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&p(e,"error",t,n)}(e,r,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,n,o){var r,s,i,a;if(u(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),i=s[t]),void 0===i)i=s[t]=n,++e._eventsCount;else if("function"==typeof i?i=s[t]=o?[n,i]:[i,n]:o?i.unshift(n):i.push(n),(r=l(e))>0&&i.length>r&&!i.warned){i.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=i.length,a=c,console&&console.warn&&console.warn(a)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(e,t,n){var o={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=f.bind(o);return r.listener=n,o.wrapFn=r,r}function g(e,t,n){var o=e._events;if(void 0===o)return[];var r=o[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):h(r,r.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),o=0;o<t;++o)n[o]=e[o];return n}function p(e,t,n,o){if("function"==typeof e.on)o.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){o.once&&e.removeEventListener(t,r),n(s)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var a=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw a.context=i,a}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var u=c.length,l=h(c,u);for(n=0;n<u;++n)s(l[n],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,E(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,E(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,o,r,s,i;if(u(t),void 0===(o=this._events))return this;if(void 0===(n=o[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){i=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(o[e]=n[0]),void 0!==o.removeListener&&this.emit("removeListener",e,i||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,o;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(o=0;o<s.length;++o)"removeListener"!==(r=s[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},a.prototype.listeners=function(e){return g(this,e,!0)},a.prototype.rawListeners=function(e){return g(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},52:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var o="ws/customer/?wuid="+e;return t&&(o+="&appId="+t),n&&(o+="&disableStream="+n),o}},53:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.params,n=e.port,o=void 0===n?8080:n,r=e.protocol,s=void 0===r?"ws":r,i=e.host,a=void 0===i?"localhost":i;return 80===o?s+"://"+a+"/"+t:s+"://"+a+":"+o+"/"+t}},54:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.cobrowsingEnabled=t.findAndCheckVersion=t.checkVersion=t.checkVersionMap=void 0;var r=n(39),s=n(40),i="all";function a(e,t){for(var n=Math.min(e.length,t.length),o=0;o<n;++o)if(t[o]!==e[o])return parseInt(t[o],10)>parseInt(e[o],10);return e.length<=t.length}function c(e,t){return!!t&&(t===i||a(t.split("."),e.split(".")))}t.checkVersion=a,t.findAndCheckVersion=c;var u=((o={})[s.BrowserName.CHROME]=i,o[""+s.BrowserName.MOBILE+s.BrowserName.CHROME]=i,o[s.BrowserName.FIREFOX]=i,o[""+s.BrowserName.MOBILE+s.BrowserName.FIREFOX]=i,o[s.BrowserName.FIREFOX_FOCUS]=i,o[""+s.BrowserName.MOBILE+s.BrowserName.FIREFOX_FOCUS]=i,o[s.BrowserName.SAFARI]="10.12.6",o[""+s.BrowserName.MOBILE+s.BrowserName.SAFARI]="10.3.3",o[s.BrowserName.EDGE]="12",o[s.BrowserName.OPERA]=i,o[""+s.BrowserName.MOBILE+s.BrowserName.OPERA]=i,o[s.BrowserName.WEBVIEW]=i,o[s.BrowserName.WEBKIT]=i,o[s.BrowserName.YANDEX]=i,o[""+s.BrowserName.MOBILE+s.BrowserName.YANDEX]=i,o);t.checkVersionMap=u,t.cobrowsingEnabled=function(e){if(!e)return!1;var t=r.getBrowserData(e.userAgent),n=t.name;return c(t.version,u[n])}},55:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=["CLOSE_NORMAL","CLOSE_GOING_AWAY","CLOSE_PROTOCOL_ERROR","CLOSE_UNSUPPORTED","1004","CLOSE_NO_STATUS","CLOSE_ABNORMAL","Unsupported Data","Policy Violation","CLOSE_TOO_LARGE","Missing Extension","Internal Error","Service Restart","Try Again Later"];t.default=function(e){return o[e-1e3]}}}]);  